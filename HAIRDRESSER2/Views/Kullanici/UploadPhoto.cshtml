@{
    ViewBag.Title = "Saç Modeli Önerisi";
}

<h2>Saç Modeli Önerisi</h2>

<p>Bir fotoğraf yükleyerek sizin için en uygun saç modelini keşfedin.</p>

<form id="photoUploadForm" enctype="multipart/form-data">
    <div>
        <label for="photo">Fotoğraf Yükle:</label>
        <input type="file" id="photo" accept="image/*" required />
    </div>
    <button type="button" id="submitButton">Önerileri Al</button>
</form>

<div id="recommendations" style="margin-top: 20px; display: none;">
    <h3>Öneriler:</h3>
    <ul id="recommendationList"></ul>
</div>

<div id="loading" style="margin-top: 20px; display: none;">
    <p>Lütfen bekleyin, öneriler alınıyor...</p>
</div>

<script>
    document.getElementById('submitButton').addEventListener('click', async () => {
        const fileInput = document.getElementById('photo');
        const file = fileInput.files[0];

        if (!file) {
            alert('Lütfen bir fotoğraf seçin.');
            return;
        }

        // Fotoğrafı yüklemeden önce kullanıcıyı bilgilendir
        document.getElementById('loading').style.display = 'block';

        const reader = new FileReader();
        reader.onload = async () => {
            try {
                const base64Photo = reader.result.split(',')[1]; // Fotoğrafı Base64 olarak al

                const response = await fetch('/api/Recommendation/GetHairStyleRecommendation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ PhotoBase64: base64Photo })
                });

                if (response.ok) {
                    const data = await response.json();

                    // Önerileri listeye ekle
                    const recommendationList = document.getElementById('recommendationList');
                    recommendationList.innerHTML = ''; // Önceki önerileri temizle
                    data.Recommendations.forEach(rec => {
                        const listItem = document.createElement('li');
                        listItem.textContent = rec;
                        recommendationList.appendChild(listItem);
                    });

                    document.getElementById('recommendations').style.display = 'block';
                } else {
                    // API'den hata mesajını al ve göster
                    const errorData = await response.json();
                    alert(errorData.Message || 'Öneriler alınırken bir hata oluştu.');
                }
            } catch (error) {
                alert('Bir hata oluştu: ' + error.message);
            } finally {
                // Yükleme göstergesini gizle
                document.getElementById('loading').style.display = 'none';
            }
        };

        reader.readAsDataURL(file); // Fotoğrafı Base64 formatına çevir
    });
</script>
