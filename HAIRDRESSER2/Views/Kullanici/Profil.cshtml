@model HAIRDRESSER2.Models.ApplicationUser

@{
    ViewBag.Title = "Profil";
}

<h2>@Model.Ad @Model.Soyad - Profil</h2>

<div class="mt-4">
    <h3>Seçenekler</h3>
    <div class="btn-group" role="group" aria-label="Kullanıcı Seçenekleri">
        <a class="btn btn-primary" asp-controller="Kullanici" asp-action="Profil">Profilim</a>
        <a class="btn btn-secondary" asp-controller="Kullanici" asp-action="Randevularim">Randevularım</a>
        <a class="btn btn-success" asp-controller="Randevu" asp-action="RandevuAl">Randevu Al</a>
    </div>
</div>

<hr />

<div style="margin-bottom: 20px;">
    <h3>Kişisel Bilgiler</h3>
    <p><strong>Email:</strong> @Model.Email</p>
    <p><strong>Telefon:</strong> @Model.PhoneNumber</p>
</div>

<h3>Randevular</h3>
@if (Model.Randevular != null && Model.Randevular.Any())
{
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Tarih</th>
                <th>Saat</th>
                <th>Uzman Adı</th>
                <th>Uzman Soyadı</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var randevu in Model.Randevular)
            {
                <tr>
                    <td>@randevu.Tarih.ToShortDateString()</td>
                    <td>@randevu.Saat</td>
                    <td>@randevu.Uzman.Ad</td>
                    <td>@randevu.Uzman.Soyad</td>
                    <td>
                        <form asp-action="RandevuIptal" asp-controller="Kullanici" method="post" style="display:inline;">
                            <input type="hidden" name="randevuId" value="@randevu.Id" />
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Bu randevuyu iptal etmek istediğinize emin misiniz?');">İptal Et</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>Henüz randevunuz bulunmamaktadır.</p>
}

<hr />

<h3>Saç Modeli Önerisi</h3>
<p>Bir fotoğraf yükleyerek sizin için en uygun saç modelini keşfedin.</p>

<form id="photoUploadForm" enctype="multipart/form-data">
    <div>
        <label for="photo">Fotoğraf Yükle:</label>
        <input type="file" id="photo" accept="image/*" required />
    </div>
    <button type="button" id="submitButton" class="btn btn-primary mt-2">Önerileri Al</button>
</form>

<div id="recommendations" style="margin-top: 20px; display: none;">
    <h3>Öneriler:</h3>
    <ul id="recommendationList"></ul>
</div>

<script>
    document.getElementById('submitButton').addEventListener('click', async () => {
        const fileInput = document.getElementById('photo');
        const file = fileInput.files[0];

        if (!file) {
            alert('Lütfen bir fotoğraf seçin.');
            return;
        }

        const reader = new FileReader();
        reader.onload = async () => {
            const base64Photo = reader.result.split(',')[1]; // Fotoğrafı Base64 olarak al
            try {
                const response = await fetch('/api/Recommendation/GetHairStyleRecommendation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ PhotoBase64: base64Photo })
                });

                if (response.ok) {
                    const data = await response.json();
                    const recommendationList = document.getElementById('recommendationList');
                    recommendationList.innerHTML = ''; // Önceki önerileri temizle
                    data.Recommendations.forEach(rec => {
                        const listItem = document.createElement('li');
                        listItem.textContent = rec;
                        recommendationList.appendChild(listItem);
                    });
                    document.getElementById('recommendations').style.display = 'block';
                } else {
                    alert('Öneriler alınırken bir hata oluştu.');
                }
            } catch (error) {
                console.error('Hata:', error);
                alert('Bir hata oluştu. Lütfen tekrar deneyin.');
            }
        };

        reader.readAsDataURL(file); // Fotoğrafı Base64 formatına çevir
    });
</script>
